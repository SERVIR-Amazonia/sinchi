exports.rf =function RFprim(trainingPts, testingPts,inputImage) {
    var trainingData = inputImage.sampleRegions({
        collection: trainingPts,
        properties: ['nivel_1'],
        scale: 20
    });
    print(" trainingData", trainingData);
    
    var testingData = inputImage.sampleRegions({
        collection: testingPts,
        properties: ['nivel_1'],
        scale: 20
    });
    //print(" testinggData", testingData)
    
    

    var classifier = ee.Classifier.smileRandomForest(100).train({
        features: trainingData,
        classProperty: 'nivel_1',
        inputProperties: inputImage.bandNames()
    });


    return {
        classified_image: inputImage.classify(classifier),
        rfclassifier: classifier,
        trainingData:testingData,
        testingData:testingData
        
    };
    
};

exports.primitives_class=function(){
  
};

exports.calculateConfusionMatrix = function(testingSet, RFclassifier) {
    var confusionMatrix = testingSet.classify(RFclassifier)
        .errorMatrix({
            actual: 'nivel_1',
            predicted: 'classification'
        });
        // Print the results.
      print('Confusion matrix:', confusionMatrix);
      print('Overall Accuracy:', confusionMatrix.accuracy());
      print('Producers Accuracy:', confusionMatrix.producersAccuracy());
      print('Consumers Accuracy:', confusionMatrix.consumersAccuracy());
      print('Kappa:', confusionMatrix.kappa());

    return confusionMatrix;
};

exports.importance=function(classifier){
  
  // Run .explain() to see what the classifer looks like
  print(classifier.explain());
  
  // Calculate variable importance
  var importance = ee.Dictionary(classifier.explain().get('importance'));
  
  // Calculate relative importance
  var sum = importance.values().reduce(ee.Reducer.sum());
  
  var relativeImportance = importance.map(function(key, val) {
     return (ee.Number(val).multiply(100)).divide(sum)
    });
  print(relativeImportance);
  
  // Create a FeatureCollection so we can chart it
  var importanceFc = ee.FeatureCollection([
    ee.Feature(null, relativeImportance)
  ]);
  
  var chart = ui.Chart.feature.byProperty({
    features: importanceFc
  }).setOptions({
        title: 'Feature Importance',
        vAxis: {title: 'Importance'},
        hAxis: {title: 'Feature'}
    });
  print(chart);
};